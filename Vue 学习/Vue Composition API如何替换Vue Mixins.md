<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding: 0 10px; word-spacing: 0px; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; line-height: 1.6; letter-spacing: .034em; color: rgb(63, 63, 63); font-size: 16px; word-break: all;"><p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">想在您的Vue组件之间共享代码？如果您熟悉Vue 2，则可能已为此目的使用了mixin。但是新的Composition API（现在可以作为Vue 2的插件和Vue 3的即将发布的功能使用）提供了更好的解决方案。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">在本文中，我们将研究mixins的缺点，并查看Composition API如何克服它们，并使Vue应用程序具有更大的可伸缩性。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">简而言之</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">让我们快速回顾一下mixins模式，因为对于下一部分将要介绍的内容，请务必将其放在首位。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">之类的东西-通常情况下，Vue公司的组件用JavaScript对象与代表我们所需要的功能的各种属性定义data，methods，computed，等等。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;MyComponent.js<br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;myDataProperty:&nbsp;null<br>&nbsp;&nbsp;}),<br>&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">myMethod</span></span>&nbsp;()&nbsp;{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;//&nbsp;...<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">当我们想在组件之间共享相同的属性时，可以将公共属性提取到一个单独的模块中：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;MyMixin.js<br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;mySharedDataProperty:&nbsp;null<br>&nbsp;&nbsp;}),<br>&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">mySharedMethod</span></span>&nbsp;()&nbsp;{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">现在，我们可以通过将其分配给mixinconfig属性，将其添加到任何使用的组件中。在运行时，Vue会将组件的属性与所有添加的mixin合并。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;ConsumingComponent.js<br>import&nbsp;MyMixin&nbsp;from&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"./MyMixin.js"</span>;<br><br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;mixins:&nbsp;[MyMixin],<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;myLocalDataProperty:&nbsp;null<br>&nbsp;&nbsp;}),<br>&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">myLocalMethod</span></span>&nbsp;()&nbsp;{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">对于此特定示例，运行时使用的组件定义如下所示：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;mySharedDataProperty:&nbsp;null<br>&nbsp;&nbsp;&nbsp;&nbsp;myLocalDataProperty:&nbsp;null<br>&nbsp;&nbsp;}),<br>&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">mySharedMethod</span></span>&nbsp;()&nbsp;{&nbsp;...&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">myLocalMethod</span></span>&nbsp;()&nbsp;{&nbsp;...&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">Mixins被认为“有害”</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">早在2016年年中，丹·阿布拉莫夫（Dan Abramov）撰写了《被认为有害的Mixins》，他在文章中辩称，使用mixins在React组件中重用逻辑是一种反模式，主张改为远离它们。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">不幸的是，他提到的关于React混合的缺点同样适用于Vue。在了解Composition API如何克服这些缺点之前，让我们熟悉这些缺点。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">命名冲突</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">我们看到了混合模式如何在运行时合并两个对象。如果他们都共享同名，会发生什么？</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">const&nbsp;mixin&nbsp;=&nbsp;{<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;myProp:&nbsp;null<br>&nbsp;&nbsp;})<br>}<br><br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;mixins:&nbsp;[mixin],<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;same&nbsp;name!<br>&nbsp;&nbsp;&nbsp;&nbsp;myProp:&nbsp;null<br>&nbsp;&nbsp;})<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">这是合并策略的地方起作用的地方。这是一组规则，用于确定组件包含多个具有相同名称的选项时会发生什么。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">Vue组件的默认（但可以配置）合并策略指示本地选项将覆盖混合选项。虽然有例外。例如，如果我们有多个相同类型的生命周期挂钩，则将它们添加到挂钩数组中，并将依次调用所有挂钩。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">即使我们不应该遇到任何实际的错误，但是在跨多个组件和Mixins的命名属性进行处理时，编写代码也变得越来越困难。一旦将第三方混合作为具有自己的命名属性的npm软件包添加到npm包中，可能会引起冲突，这尤其困难。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">隐式依赖</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">混合和使用它的组件之间没有层次关系。这意味着组件可以使用在mixin中定义的数据属性（例如mySharedDataProperty），但是mixin也可以使用假定在组件中定义的数据属性（例如myLocalDataProperty）。当使用混入来共享输入验证时，通常是这种情况。mixin可能期望组件具有一个输入值，该值将在其自己的validate方法中使用。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">但是，这可能会导致问题。如果我们以后要重构组件并更改mixin所需的变量的名称，会发生什么？在查看组件时，我们不会发现任何错误。皮棉绒也不会捡起来。我们只会在运行时看到错误。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">现在想象一下一个带有一堆mixin的组件。我们可以重构本地数据属性，还是会破坏混合？哪个混蛋？我们必须手动搜索它们才能知道。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">从mixins迁移</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">Dan的文章提供了mixin的替代方法，包括高阶组件，实用程序方法和其他一些组件组成模式。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">尽管Vue在许多方面与React相似，但他建议的替代模式并不能很好地转化为Vue。因此，尽管这篇文章是在2016年中撰写的，但从那时起，Vue开发人员就一直遇到混合问题。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">到现在。mixins的缺点是Composition API背后的主要推动因素之一。在查看它如何克服mixin问题之前，让我们快速概述一下它的工作原理。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">撰写API速成课程</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">Composition API的关键思想是，与其将组件的功能（例如状态，方法，计算属性等）定义为对象属性，不如将它们定义为从新setup函数。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">以定义了“计数器”功能的Vue 2组件的经典示例为例：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//Counter.vue<br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;data:&nbsp;()&nbsp;=&gt;&nbsp;({<br>&nbsp;&nbsp;&nbsp;&nbsp;count:&nbsp;0<br>&nbsp;&nbsp;}),<br>&nbsp;&nbsp;methods:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">increment</span></span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.count++;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;computed:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">double</span></span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;this.count&nbsp;*&nbsp;2;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">接下来是使用Composition API定义的完全相同的组件。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;Counter.vue<br>import&nbsp;{&nbsp;ref,&nbsp;computed&nbsp;}&nbsp;from&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"vue"</span>;<br><br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">setup</span></span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;count&nbsp;=&nbsp;ref(0);<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;double&nbsp;=&nbsp;computed(()&nbsp;=&gt;&nbsp;count&nbsp;*&nbsp;2)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">increment</span></span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count.value++;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;increment<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">您首先会注意到我们导入了一个ref函数，该函数允许我们定义一个反应变量，其功能与data变量。计算函数的情况与此相同。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">该increment方法不是被动的，因此可以将其声明为纯JavaScript函数。注意，我们需要更改子属性value才能更改count反应变量的值。那是因为使用ref必须是对象，以便在传递时保持其反应性。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">最好查阅Vue Composition API文档，以详细了解ref的工作原理。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">一旦定义了这些功能，就可以从设置函数中返回它们。上面两个组件之间的功能没有区别。我们所做的只是使用替代API。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">提示： Composition API将是Vue 3的核心功能，但您也可以在Nue插件中的NPM插件中使用它@vue/composition-api。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">代码提取</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">Composition API的第一个明显优点是提取逻辑很容易。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">让我们使用Composition API重构上面定义的组件，以使我们定义的功能位于JavaScript模块中useCounter。（在功能描述前加“ use”是Composition API的命名约定。）</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;useCounter.js<br>import&nbsp;{&nbsp;ref,&nbsp;computed&nbsp;}&nbsp;from&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"vue"</span>;<br><br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">function</span></span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;const&nbsp;count&nbsp;=&nbsp;ref(0);<br>&nbsp;&nbsp;const&nbsp;double&nbsp;=&nbsp;computed(()&nbsp;=&gt;&nbsp;count&nbsp;*&nbsp;2)<br>&nbsp;&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">increment</span></span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;count.value++;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;count,<br>&nbsp;&nbsp;&nbsp;&nbsp;double,<br>&nbsp;&nbsp;&nbsp;&nbsp;increment<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">代码重用</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">要在组件中使用该功能，我们只需将模块导入到组件文件中并调用它（注意导入是一个函数）。这将返回我们定义的变量，随后我们可以从设置函数中返回它们。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">//&nbsp;MyComponent.js<br>import&nbsp;useCounter&nbsp;from&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"./useCounter.js"</span>;<br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">setup</span></span>()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;count,&nbsp;double,&nbsp;increment&nbsp;}&nbsp;=&nbsp;useCounter();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;increment<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">乍一看，这看起来似乎有些冗长且毫无意义，但让我们看看这种模式如何克服了前面讨论的mixins问题。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">命名冲突...解决了！</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">我们之前已经了解了mixin如何使用与消费组件中的名称同名的属性，或者甚至更阴险地使用消费组件使用的其他mixin中的属性。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">组成API并不是问题，因为我们需要显式命名组成函数返回的任何状态或方法：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;"><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">setup</span></span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;someVar1,&nbsp;someMethod1&nbsp;}&nbsp;=&nbsp;useCompFunction1();<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;someVar2,&nbsp;someMethod2&nbsp;}&nbsp;=&nbsp;useCompFunction2();<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">return</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;someVar1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;someMethod1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;someVar2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;someMethod2<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">命名冲突将以与其他JavaScript变量相同的方式解决。</p>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">隐式依赖...解决了！</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">我们之前还看到了mixin如何使用消费组件上定义的数据属性，这可能会使代码易碎且难以推理。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">合成函数还可以调用在使用组件中定义的局部变量。但是，不同之处在于，现在必须将此变量显式传递给composition函数。</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #abb2bf; display: -webkit-box; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #282c34; border-radius: 5px;">import&nbsp;useCompFunction&nbsp;from&nbsp;<span class="hljs-string" style="color: #98c379; line-height: 26px;">"./useCompFunction"</span>;<br><br><br><span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">export</span>&nbsp;default&nbsp;{<br>&nbsp;&nbsp;<span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #61aeee; line-height: 26px;">setup</span></span>&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;some&nbsp;<span class="hljs-built_in" style="color: #e6c07b; line-height: 26px;">local</span>&nbsp;value&nbsp;the&nbsp;a&nbsp;composition&nbsp;<span class="hljs-keyword" style="color: #c678dd; line-height: 26px;">function</span>&nbsp;needs&nbsp;to&nbsp;use<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;myLocalVal&nbsp;=&nbsp;ref(0);<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;it&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;passed&nbsp;as&nbsp;an&nbsp;argument<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;{&nbsp;...&nbsp;}&nbsp;=&nbsp;useCompFunction(myLocalVal);<br>&nbsp;&nbsp;}<br>}<br></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-top: 30px; margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px;"><span style="background-image: url(https://my-wechat.mdnice.com/mdnice/mountain_1_20191028221337.png); background-size: 15px 15px; display: inline-block; width: 15px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 16px; font-weight: bold; display: inline-block; margin-left: 8px; color: rgb(60,112,198);">包起来</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">mixin模式在表面上看起来非常安全。但是，通过合并对象共享代码成为一种反模式，这是因为它增加了代码的脆弱性，并且掩盖了对功能进行推理的能力。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">Composition API最聪明的部分是，它允许Vue依靠本机JavaScript内置的安全措施来共享代码，例如将变量传递给函数和模块系统。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 23px; color: rgb(74,74,74); line-height: 1.75em;">这是否意味着Composition API在各个方面都优于Vue的经典API？不会。在大多数情况下，您可以坚持使用经典API。但是，如果您打算重用代码，那么Composition API无疑是上乘的。</p>
</section>